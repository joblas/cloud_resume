#steps:
# Install node dependencies
#- name: 'gcr.io/cloud-builders/npm'
#  args: ['install']
#  dir: 'functions'

# Run linting
#- name: 'gcr.io/cloud-builders/npm'
 # args: ['run', 'lint']
 # dir: 'functions'

# Deploy to Firebase
# Note: this step requires the Firebase token to be stored as a Secret in Cloud Build
#- name: 'gcr.io/cloud-resume-34b6d/firebase'
#  args: ['deploy', '--token', '1//06XOJpJi3aCATCgYIARAAGAYSNwF-L9IrwBxMXlVegF5x7LCzd-AHh5Z69K4_XVkyjT44pKB7aeSLETED4n4DRLTYp45hzNIKVlA']


#steps:
#- name: 'gcr.io/cloud-builders/npm'
#  args: ['install']
#- name: 'gcr.io/cloud-builders/npm'
#  args: ['run', 'build']
#- name: 'gcr.io/cloud-resume-34b6d/firebase'
#  entrypoint: 'bash'
#  args: ['-c', 'npm install -g firebase-tools && firebase deploy --only functions --token "1//06MD93-L38HRXCgYIARAAGAYSNwF-L9IrPHMXx6gI2bh7oGQpFRd-JGs9yyhkqs53ij-UwUrJT89JNwttdx8Z-xYex86tBH4oqcc"']
#  secrets:
#- secretEnv: ['1//06MD93-L38HRXCgYIARAAGAYSNwF-L9IrPHMXx6gI2bh7oGQpFRd-JGs9yyhkqs53ij-UwUrJT89JNwttdx8Z-xYex86tBH4oqcc']
#  kmsKeyName: projects/cloud-resume-34b6d/locations/global/keyRings/cloudbuild/cryptoKeys/firebase-token

steps:
- name: 'gcr.io/cloud-builders/npm'
  args: ['install']
- name: 'gcr.io/cloud-builders/npm'
  args: ['test']
- name: 'gcr.io/cloud-builders/npm'
  args: ['build']
- name: 'gcr.io/cloud-resume-34b6d/firebase'
  args: ['deploy', '--token', '1//06MD93-L38HRXCgYIARAAGAYSNwF-L9IrPHMXx6gI2bh7oGQpFRd-JGs9yyhkqs53ij-UwUrJT89JNwttdx8Z-xYex86tBH4oqcc']
  secretEnv: ['1//06MD93-L38HRXCgYIARAAGAYSNwF-L9IrPHMXx6gI2bh7oGQpFRd-JGs9yyhkqs53ij-UwUrJT89JNwttdx8Z-xYex86tBH4oqcc']

secrets:
- kmsKeyName: projects/cloud-resume-34b6d/locations/global/keyRings/cloudbuild/cryptoKeys/firebase-token
  secretEnv:
    _FIREBASE_TOKEN: MS8vMDZNRDkzLUwzOEhSWENnWUlBUkFBR0FZU053Ri1MOUlyUEhNWHg2Z0kyYmg3b0dRcEZSZC1KR3M5eXloa3FzNTNpai1Vd1VySlQ4OUpOd3R0ZHg4Wi14WWV4ODZ0Qkg0b3FjYw==
